---
phase: 06-gallery-page
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - src/components/gallery/GalleryImage.tsx
  - src/components/gallery/ImageMasonry.tsx
  - src/components/gallery/ImageLightbox.tsx
  - src/components/gallery/index.ts
  - src/routes/pages/Gallery.tsx
  - src/routes/index.tsx
  - public/images/gallery/jerash-site-01.jpg through jerash-site-26.jpg
autonomous: true

must_haves:
  truths:
    - "All 26 images display in masonry grid layout"
    - "Clicking image opens lightbox with zoom and navigation"
    - "Images lazy load for performance"
    - "Skeleton placeholders show while images load"
    - "Images brighten on hover"
    - "Stagger animation reveals images as they enter viewport"
  artifacts:
    - path: "src/components/gallery/GalleryImage.tsx"
      provides: "Single image with skeleton loading state"
      exports: ["GalleryImage"]
      min_lines: 30
    - path: "src/components/gallery/ImageMasonry.tsx"
      provides: "Masonry grid wrapper with responsive breakpoints"
      exports: ["ImageMasonry"]
      min_lines: 40
    - path: "src/components/gallery/ImageLightbox.tsx"
      provides: "Lightbox with zoom plugin"
      exports: ["ImageLightbox"]
      min_lines: 30
    - path: "src/routes/pages/Gallery.tsx"
      provides: "Gallery page component"
      exports: ["GalleryPage"]
      min_lines: 40
  key_links:
    - from: "src/routes/pages/Gallery.tsx"
      to: "src/data/gallery-images.ts"
      via: "import galleryImages"
      pattern: "import.*galleryImages.*from.*gallery-images"
    - from: "src/components/gallery/ImageMasonry.tsx"
      to: "react-masonry-css"
      via: "import Masonry"
      pattern: "import Masonry from 'react-masonry-css'"
    - from: "src/components/gallery/ImageLightbox.tsx"
      to: "yet-another-react-lightbox"
      via: "import Lightbox"
      pattern: "import Lightbox from \"yet-another-react-lightbox\""
    - from: "src/routes/index.tsx"
      to: "src/routes/pages/Gallery.tsx"
      via: "route definition"
      pattern: "path: 'gallery'"
---

<objective>
Build the gallery UI components and assemble the complete gallery page.

Purpose: Delivers the interactive masonry gallery with lightbox zoom, lazy loading, skeleton placeholders, and stagger animations per CONTEXT.md decisions.

Output: GalleryImage, ImageMasonry, ImageLightbox components, Gallery page wired to /gallery route, placeholder images created.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-gallery-page/06-CONTEXT.md
@.planning/phases/06-gallery-page/06-RESEARCH.md
@.planning/phases/06-gallery-page/06-01-SUMMARY.md

@src/data/gallery-images.ts (from 06-01)
@src/routes/pages/HSE.tsx (page structure pattern)
@src/routes/pages/Services.tsx (page structure pattern)
@src/components/animations/FadeIn.tsx (animation pattern)
@src/components/hse/ParallaxImage.tsx (image component pattern)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create GalleryImage component with skeleton</name>
  <files>src/components/gallery/GalleryImage.tsx</files>
  <action>
Create a single image component that handles loading states:

```typescript
interface GalleryImageProps {
  src: string
  alt: string
  width: number
  height: number
  onClick: () => void
}
```

Implementation requirements:
1. **Skeleton state:** Show pulsing gray placeholder while image loads
   - Use Tailwind `animate-pulse bg-gray-200 dark:bg-gray-700`
   - Skeleton matches exact aspect ratio: `style={{ aspectRatio: width/height }}`
   - Add `aria-busy="true"` and `aria-label="Loading image"` for accessibility

2. **Image loading:** Track loaded state with useState
   - Set `loading="lazy"` for native lazy loading
   - Include explicit `width` and `height` attributes (prevents layout shift)
   - On load, transition skeleton out with opacity animation

3. **Hover effect:** Brightness lift on hover (not scale per CONTEXT.md)
   - Use `group-hover:brightness-110 transition-all duration-300`
   - Wrap in div with `cursor-pointer group` classes

4. **Click handler:** Pass onClick prop for lightbox opening

5. **Styling:**
   - `w-full h-auto` for responsive sizing
   - `rounded` for slight border radius
   - Absolute positioning for image over skeleton during transition
  </action>
  <verify>
File exists at src/components/gallery/GalleryImage.tsx.
TypeScript compiles without errors.
Component exports GalleryImage.
  </verify>
  <done>GalleryImage component renders image with skeleton loading state, brightness hover effect, and click handler.</done>
</task>

<task type="auto">
  <name>Task 2: Create ImageMasonry grid component</name>
  <files>src/components/gallery/ImageMasonry.tsx</files>
  <action>
Create the masonry grid wrapper using react-masonry-css:

```typescript
interface ImageMasonryProps {
  children: React.ReactNode
}
```

Implementation requirements:
1. **Responsive breakpoints** (per CONTEXT.md):
   - Desktop (default): 4 columns
   - Tablet (1024px): 3 columns
   - Mobile (640px): 2 columns

2. **Gap spacing:** 8px tight gap (per CONTEXT.md - "images feel connected")
   - Use `className="flex -ml-2 w-auto"` on Masonry
   - Use `columnClassName="pl-2 bg-clip-padding"` for columns
   - Add `mb-2` to child items for vertical gap

3. **Stagger animation wrapper:**
   - Wrap Masonry in Framer Motion container
   - Use `whileInView="visible"` with `viewport={{ once: true, amount: 0.1, margin: "200px 0px" }}`
   - Stagger children at 50ms (0.05s) per research - 26 items = 1.3s total (acceptable)

   Container variants:
   ```typescript
   const containerVariants = {
     hidden: {},
     visible: {
       transition: {
         staggerChildren: 0.05,
         delayChildren: 0.1
       }
     }
   }
   ```

4. **Item variants** (for children to use):
   ```typescript
   const itemVariants = {
     hidden: { opacity: 0, y: 20 },
     visible: {
       opacity: 1,
       y: 0,
       transition: { duration: 0.4, ease: 'easeOut' }
     }
   }
   ```

   Export itemVariants so GalleryImage can use it, or apply motion.div wrapper internally.

5. **CSS for masonry columns:**
   Include inline or tailwind classes for masonry grid structure.
  </action>
  <verify>
File exists at src/components/gallery/ImageMasonry.tsx.
Imports `react-masonry-css`.
Has responsive breakpoint object with 4/3/2 columns.
  </verify>
  <done>ImageMasonry renders CSS-based masonry grid with 4/3/2 responsive columns, 8px gaps, and stagger animation on viewport entry.</done>
</task>

<task type="auto">
  <name>Task 3: Create ImageLightbox component</name>
  <files>src/components/gallery/ImageLightbox.tsx</files>
  <action>
Create the lightbox wrapper using yet-another-react-lightbox with Zoom plugin:

```typescript
import Lightbox from "yet-another-react-lightbox"
import Zoom from "yet-another-react-lightbox/plugins/zoom"
import "yet-another-react-lightbox/styles.css"

interface ImageLightboxProps {
  open: boolean
  index: number
  slides: Array<{ src: string; alt: string; width: number; height: number }>
  onClose: () => void
}
```

Implementation requirements:
1. **Zoom configuration** (per CONTEXT.md - pinch/scroll zoom):
   ```typescript
   zoom={{
     maxZoomPixelRatio: 2,
     scrollToZoom: true,
     doubleClickMaxStops: 2
   }}
   ```

2. **Carousel settings:**
   - `finite: true` (don't loop, 26 images has clear start/end)

3. **Controller settings** (per CONTEXT.md):
   - `closeOnBackdropClick: true` (important for mobile)

4. **Dark backdrop** (per CONTEXT.md - black/dark gray so images pop):
   ```typescript
   styles={{
     container: { backgroundColor: "rgba(0, 0, 0, 0.95)" }
   }}
   ```

5. **Counter display:** Lightbox shows built-in "3 of 26" by default - this satisfies CONTEXT.md "minimal counter display"

6. **Swipe navigation:** Native to yet-another-react-lightbox, no extra config needed.

7. **RTL support:** Library respects document dir attribute automatically.
  </action>
  <verify>
File exists at src/components/gallery/ImageLightbox.tsx.
Imports Lightbox and Zoom plugin.
Has zoom configuration with scrollToZoom.
  </verify>
  <done>ImageLightbox renders lightbox with Zoom plugin, swipe navigation, pinch zoom, dark backdrop, and close on backdrop click.</done>
</task>

<task type="auto">
  <name>Task 4: Create barrel export and Gallery page</name>
  <files>src/components/gallery/index.ts, src/routes/pages/Gallery.tsx, src/routes/index.tsx, public/images/gallery/*.jpg</files>
  <action>
**Part A: Create barrel export**

Create `src/components/gallery/index.ts`:
```typescript
export { GalleryImage } from './GalleryImage'
export { ImageMasonry } from './ImageMasonry'
export { ImageLightbox } from './ImageLightbox'
```

**Part B: Create Gallery page**

Create `src/routes/pages/Gallery.tsx` following HSE.tsx and Services.tsx patterns:

1. **Imports:**
   - useState from react
   - useTranslation from react-i18next
   - SEO from @/components/common/SEO
   - Section, Container from @/components/layout
   - FadeIn from @/components/animations/FadeIn
   - galleryImages from @/data/gallery-images
   - GalleryImage, ImageMasonry, ImageLightbox from @/components/gallery

2. **State:** `const [lightboxIndex, setLightboxIndex] = useState(-1)` (-1 means closed)

3. **Structure:**
   ```tsx
   <>
     <SEO title={t('seo.title')} description={t('seo.description')} url="/gallery" />

     <Section className="py-16 md:py-20">
       <Container>
         {/* Simple title header per CONTEXT.md */}
         <FadeIn className="mb-8 text-center">
           <h1 className="text-3xl font-bold md:text-4xl lg:text-5xl">{t('title')}</h1>
           <p className="mt-4 text-muted-foreground">{t('description')}</p>
         </FadeIn>

         {/* Masonry grid */}
         <ImageMasonry>
           {galleryImages.map((image, idx) => (
             <GalleryImage
               key={image.id}
               {...image}
               onClick={() => setLightboxIndex(idx)}
             />
           ))}
         </ImageMasonry>
       </Container>
     </Section>

     {/* Lightbox */}
     <ImageLightbox
       open={lightboxIndex >= 0}
       index={lightboxIndex}
       slides={galleryImages.map(img => ({
         src: img.src,
         alt: img.alt,
         width: img.width,
         height: img.height
       }))}
       onClose={() => setLightboxIndex(-1)}
     />
   </>
   ```

4. **Export:** Both named and default export (following existing pattern)

**Part C: Add route**

Update `src/routes/index.tsx`:
- Import GalleryPage from './pages/Gallery'
- Add route: `{ path: 'gallery', element: <GalleryPage /> }`
- Place after 'hse' route

**Part D: Create placeholder images**

Create 26 placeholder 1px JPEG files in `public/images/gallery/`:
- jerash-site-01.jpg through jerash-site-26.jpg
- Use same 1px placeholder pattern as HSE images

Create the directory first:
```bash
mkdir -p public/images/gallery
```

Then create 26 minimal JPEG placeholders (same base64 1px JPEG pattern used elsewhere).
  </action>
  <verify>
`ls src/components/gallery/` shows GalleryImage.tsx, ImageMasonry.tsx, ImageLightbox.tsx, index.ts.
`pnpm build` completes without errors.
`grep -c "jerash-site" public/images/gallery/ | wc -l` or `ls public/images/gallery/*.jpg | wc -l` returns 26.
Route /gallery loads in dev server (pnpm dev).
  </verify>
  <done>Gallery components exported, GalleryPage assembled with masonry grid and lightbox, route added at /gallery, 26 placeholder images created.</done>
</task>

</tasks>

<verification>
1. `pnpm build` - compiles without errors
2. `pnpm dev` - start dev server, navigate to /gallery
3. Gallery page shows:
   - "Gallery" title and description in center
   - 26 images in masonry grid (4 columns on desktop, 3 on tablet, 2 on mobile)
   - Images have skeleton loading state (pulsing gray boxes)
   - Images brighten on hover
   - Images animate in with stagger as you scroll
4. Click any image:
   - Lightbox opens with dark backdrop
   - Shows "X of 26" counter
   - Arrow keys / swipe navigates between images
   - Scroll wheel / pinch zooms in
   - Click backdrop or X button closes
5. Switch to Arabic:
   - Title shows "المعرض"
   - Description in Arabic
   - Lightbox navigation still works (RTL)
</verification>

<success_criteria>
- All 26 images display in masonry grid with 4/3/2 column responsive layout
- Clicking image opens lightbox with zoom, swipe, and navigation
- Images lazy load with skeleton placeholders (no layout shift)
- Stagger animation reveals images on viewport entry
- Hover brightens images (not scale)
- Gallery accessible at /gallery route
- Page displays correctly in both Arabic and English
</success_criteria>

<output>
After completion, create `.planning/phases/06-gallery-page/06-02-SUMMARY.md`
</output>
