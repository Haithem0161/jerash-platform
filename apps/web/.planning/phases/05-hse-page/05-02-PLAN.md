---
phase: 05-hse-page
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - src/components/hse/ParallaxImage.tsx
  - src/components/hse/SafetyMetrics.tsx
  - src/routes/pages/HSE.tsx
  - public/images/hse/placeholder.txt
autonomous: true

must_haves:
  truths:
    - "Field images display with subtle parallax scroll effect"
    - "Safety metrics animate with counters when scrolled into view"
    - "HSE page has bold visual design with interspersed imagery"
    - "Page flows: Hero -> Commitments -> Images -> Metrics"
  artifacts:
    - path: "src/components/hse/ParallaxImage.tsx"
      provides: "Reusable parallax image component"
      contains: "useScroll"
    - path: "src/components/hse/SafetyMetrics.tsx"
      provides: "Safety metrics section with animated counters"
      contains: "AnimatedCounter"
    - path: "src/routes/pages/HSE.tsx"
      provides: "Complete HSE page with all sections assembled"
      min_lines: 40
  key_links:
    - from: "src/components/hse/ParallaxImage.tsx"
      to: "motion/react"
      via: "useScroll, useTransform, useSpring"
      pattern: "useScroll.*useTransform.*useSpring"
    - from: "src/components/hse/SafetyMetrics.tsx"
      to: "src/components/animations/AnimatedCounter.tsx"
      via: "import and render"
      pattern: "AnimatedCounter"
    - from: "src/routes/pages/HSE.tsx"
      to: "src/components/hse/ParallaxImage.tsx"
      via: "import and render between sections"
      pattern: "ParallaxImage"
---

<objective>
Complete HSE page with parallax field images and animated safety metrics.

Purpose: Add visual impact through parallax images and prove safety culture with animated metrics, completing the "crown jewel" page.
Output: Fully assembled HSE page with hero, commitment list, interspersed parallax images, and animated metrics at bottom.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/05-hse-page/05-CONTEXT.md
@.planning/phases/05-hse-page/05-RESEARCH.md
@.planning/phases/05-hse-page/05-01-SUMMARY.md
@src/components/animations/AnimatedCounter.tsx
@src/components/animations/StaggerContainer.tsx
@src/components/layout/Section.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ParallaxImage component</name>
  <files>src/components/hse/ParallaxImage.tsx</files>
  <action>
Create a reusable parallax image component using Framer Motion's scroll-linked animations.

Requirements from CONTEXT.md and RESEARCH.md:
- Contained images with parallax scroll effect (not full-width edge-to-edge)
- Subtle and professional parallax (not gimmicky)
- Spring-based easing for smooth performance
- Use Â±100px range as starting point (adjustable via prop)

```tsx
import { useRef } from 'react'
import { useScroll, useTransform, useSpring, motion } from 'motion/react'
import { cn } from '@/lib/utils'

interface ParallaxImageProps {
  src: string
  alt: string
  className?: string
  /** Parallax intensity in pixels (default: 100) */
  intensity?: number
}

/**
 * Image with subtle parallax scroll effect.
 * Uses spring easing for smooth animation.
 * Only animates transform (GPU-accelerated) for performance.
 */
export function ParallaxImage({
  src,
  alt,
  className,
  intensity = 100
}: ParallaxImageProps) {
  const ref = useRef<HTMLDivElement>(null)

  // Track scroll progress for this specific element
  const { scrollYProgress } = useScroll({
    target: ref,
    offset: ["start end", "end start"] // Start when element enters viewport, end when it leaves
  })

  // Transform scroll progress to parallax offset
  const rawY = useTransform(scrollYProgress, [0, 1], [intensity, -intensity])

  // Apply spring easing for smoothness (prevents stuttering on fast scroll)
  const y = useSpring(rawY, { stiffness: 300, damping: 30 })

  return (
    <div
      ref={ref}
      className={cn(
        "relative h-80 md:h-96 overflow-hidden rounded-lg",
        className
      )}
    >
      <motion.img
        src={src}
        alt={alt}
        loading="lazy" // Native lazy loading for images below fold
        style={{ y }}
        className="h-[120%] w-full object-cover" // Extra height for parallax movement
      />
    </div>
  )
}
```

Key implementation notes:
- `h-[120%]` on image provides extra height for parallax movement without gaps
- `overflow-hidden` on container clips the image during movement
- `useSpring` with stiffness: 300, damping: 30 provides smooth, professional feel
- Native `loading="lazy"` for performance (images are below fold)
  </action>
  <verify>Import ParallaxImage in HSE.tsx temporarily, test with a placeholder image. Scroll should show smooth parallax movement on the image.</verify>
  <done>ParallaxImage component exists with spring-based parallax scroll effect, configurable intensity, and lazy loading.</done>
</task>

<task type="auto">
  <name>Task 2: Create SafetyMetrics component</name>
  <files>src/components/hse/SafetyMetrics.tsx</files>
  <action>
Create safety metrics section using existing AnimatedCounter component.

Requirements from CONTEXT.md:
- Both incident-focused AND training-focused metrics combined
- Animated counters (numbers count up when scrolled into view)
- Positioned at page bottom as final impression
- Larger typography for impact

```tsx
import { useTranslation } from 'react-i18next'
import { Section } from '@/components/layout/Section'
import { AnimatedCounter, StaggerContainer, StaggerItem } from '@/components/animations'

// Placeholder values - marked for client data verification (per RESEARCH.md)
const metrics = [
  { key: 'incidentFreeHours', value: 1000000, suffix: '+' },
  { key: 'trainingHours', value: 50000, suffix: '+' },
  { key: 'certifiedPersonnel', value: 95, suffix: '%' },
] as const

/**
 * Safety metrics section with animated counters.
 * Displays incident-free hours, training hours, and certification rate.
 * Positioned at page bottom as final impression (per CONTEXT.md).
 */
export function SafetyMetrics() {
  const { t } = useTranslation('hse')

  return (
    <Section id="safety-metrics" className="bg-muted/50">
      {/* Section header */}
      <div className="mb-12 text-center">
        <h2 className="text-3xl font-bold md:text-4xl">
          {t('metrics.sectionTitle')}
        </h2>
      </div>

      {/* Metrics grid with animated counters */}
      <StaggerContainer className="grid grid-cols-1 gap-8 md:grid-cols-3">
        {metrics.map((metric) => (
          <StaggerItem key={metric.key} className="text-center">
            <div className="text-5xl font-bold md:text-6xl lg:text-7xl">
              <AnimatedCounter to={metric.value} suffix={metric.suffix} />
            </div>
            <p className="mt-3 text-lg md:text-xl text-muted-foreground">
              {t(`metrics.${metric.key}`)}
            </p>
          </StaggerItem>
        ))}
      </StaggerContainer>
    </Section>
  )
}
```

Note: Metric values (1000000, 50000, 95%) are placeholders per RESEARCH.md open question #3. Same pattern as homepage stats (03-03 decision).
  </action>
  <verify>Import SafetyMetrics in HSE.tsx, scroll to bottom. Counters should animate up from zero when section enters viewport.</verify>
  <done>SafetyMetrics component exists with three animated counters for incident-free hours, training hours, and certified personnel.</done>
</task>

<task type="auto">
  <name>Task 3: Assemble complete HSE page with interspersed images</name>
  <files>src/routes/pages/HSE.tsx, public/images/hse/placeholder.txt</files>
  <action>
Update HSE.tsx to include all sections in the correct order with parallax image breaks.

**Content flow (from CONTEXT.md):**
Hero -> Commitment Points -> Field Images (interspersed) -> Metrics at bottom

**Update src/routes/pages/HSE.tsx:**

```tsx
import { useTranslation } from 'react-i18next'
import { SEO } from '@/components/common/SEO'
import { Section } from '@/components/layout/Section'
import { Container } from '@/components/layout/Container'
import { HSEHero } from '@/components/hse/HSEHero'
import { CommitmentList } from '@/components/hse/CommitmentList'
import { ParallaxImage } from '@/components/hse/ParallaxImage'
import { SafetyMetrics } from '@/components/hse/SafetyMetrics'

export default function HSE() {
  const { t } = useTranslation('hse')

  return (
    <>
      <SEO
        title={t('title')}
        description={t('description')}
      />

      {/* Full-screen hero */}
      <HSEHero />

      {/* Commitment points section */}
      <CommitmentList />

      {/* First parallax image break - PPE/safety equipment */}
      <Section fullWidth className="py-8 md:py-12">
        <Container>
          <ParallaxImage
            src="/images/hse/ppe-equipment.jpg"
            alt="Personal Protective Equipment in the field"
          />
        </Container>
      </Section>

      {/* Second parallax image break - Team in action */}
      <Section fullWidth className="py-8 md:py-12">
        <Container>
          <ParallaxImage
            src="/images/hse/team-safety.jpg"
            alt="Team following safety protocols on site"
          />
        </Container>
      </Section>

      {/* Third parallax image break - Safety signs/procedures */}
      <Section fullWidth className="py-8 md:py-12">
        <Container>
          <ParallaxImage
            src="/images/hse/safety-signs.jpg"
            alt="Safety signage and procedures"
          />
        </Container>
      </Section>

      {/* Safety metrics at bottom (final impression) */}
      <SafetyMetrics />
    </>
  )
}
```

**Create placeholder directory and note:**
`mkdir -p public/images/hse`
Create `public/images/hse/placeholder.txt` with:
```
HSE Image Placeholders

This directory should contain HSE-related field images:
- hse-hero.jpg - Hero background image (dramatic field shot)
- ppe-equipment.jpg - PPE and safety equipment
- team-safety.jpg - Team following safety protocols
- safety-signs.jpg - Safety signage and procedures

Image requirements:
- Minimum resolution: 1920x1080 for hero, 1200x800 for parallax
- Format: JPEG for photos (smaller file size)
- Compress to under 500KB each for performance

NOTE: These are placeholder paths. Actual images need to be selected
from the 26 WhatsApp images and renamed appropriately.
```

**Create placeholder images:**
For development, copy any existing images to serve as placeholders, or use CSS background colors as fallback.

Note: Per CONTEXT.md, field images should be "Mix of PPE/safety equipment AND team-in-action imagery" with "3-4 image breaks throughout the page".
  </action>
  <verify>
1. `pnpm dev` - navigate to /hse
2. Scroll through entire page - should see: Hero -> Commitments -> 3 parallax images -> Metrics
3. Parallax effect visible on scroll (images move slower than page)
4. Counters animate when metrics section enters view
5. `pnpm build` passes without errors
  </verify>
  <done>HSE page fully assembled with hero, commitment list, 3 parallax image breaks, and animated safety metrics at bottom.</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `pnpm build` passes without errors
2. Navigate to http://localhost:5173/hse
3. Full page scroll test:
   - Hero fills viewport with text readable over gradient
   - Commitment list with 10 numbered points, stagger animation
   - 3 parallax images with smooth scroll effect
   - Safety metrics with animated counters at bottom
4. Parallax smoothness test: Fast scroll and slow scroll both feel smooth (spring easing)
5. RTL test: Switch to Arabic, verify layout and text display correctly
6. Reduced motion test: Enable prefers-reduced-motion, verify animations respect setting
</verification>

<success_criteria>
- ParallaxImage component works with configurable intensity
- SafetyMetrics displays 3 animated counters
- HSE page assembled with correct section order
- 3 parallax image breaks interspersed between content
- Metrics at page bottom as final impression
- Smooth parallax effect (spring easing, no stuttering)
- No TypeScript or build errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-hse-page/05-02-SUMMARY.md`
</output>
