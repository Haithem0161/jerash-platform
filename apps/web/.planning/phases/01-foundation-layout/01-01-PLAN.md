---
phase: 01-foundation-layout
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/locales/en/common.json
  - src/locales/ar/common.json
  - src/components/common/LanguageSwitcher.tsx
  - src/components/layout/RootLayout.tsx
  - src/components/common/LoadingOverlay.tsx
  - src/hooks/useFirstVisit.ts
  - src/components/common/index.ts
  - src/hooks/index.ts
autonomous: true

must_haves:
  truths:
    - "User can toggle between Arabic and English via dropdown"
    - "Language preference persists across browser sessions"
    - "Content fades briefly when language changes"
    - "Logo animation appears on first visit per session"
    - "Loading overlay skips on subsequent navigation"
  artifacts:
    - path: "src/locales/en/common.json"
      provides: "English translations for nav, footer, language labels"
      contains: "nav.home"
    - path: "src/locales/ar/common.json"
      provides: "Arabic translations for nav, footer, language labels"
      contains: "nav.home"
    - path: "src/components/common/LanguageSwitcher.tsx"
      provides: "Dropdown-style language switcher"
      contains: "DropdownMenu"
    - path: "src/components/common/LoadingOverlay.tsx"
      provides: "Logo animation overlay"
      contains: "AnimatePresence"
    - path: "src/hooks/useFirstVisit.ts"
      provides: "sessionStorage hook for first-visit tracking"
      contains: "sessionStorage"
  key_links:
    - from: "src/components/common/LanguageSwitcher.tsx"
      to: "i18n.changeLanguage"
      via: "onClick handler"
      pattern: "changeLanguage"
    - from: "src/components/layout/RootLayout.tsx"
      to: "LoadingOverlay"
      via: "import and render"
      pattern: "LoadingOverlay"
    - from: "src/components/common/LoadingOverlay.tsx"
      to: "src/hooks/useFirstVisit.ts"
      via: "hook usage"
      pattern: "useFirstVisit"
---

<objective>
Enhance i18n infrastructure with dropdown language switcher, page transition fade, and branded loading overlay.

Purpose: Establishes the bilingual foundation that all subsequent components build on. The loading overlay creates a polished first impression.

Output: Expanded translation files, dropdown language switcher, fade transition on language change, and logo loading animation that shows only on first session visit.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-layout/01-CONTEXT.md
@.planning/phases/01-foundation-layout/01-RESEARCH.md
@I18N.md
@FRAMER-MOTION.md
@SHADCN.md

@src/lib/i18n.ts
@src/components/common/LanguageSwitcher.tsx
@src/components/layout/RootLayout.tsx
@src/locales/en/common.json
@src/locales/ar/common.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Expand translation files and convert LanguageSwitcher to dropdown</name>
  <files>
    - src/locales/en/common.json
    - src/locales/ar/common.json
    - src/components/common/LanguageSwitcher.tsx
  </files>
  <action>
1. **Expand src/locales/en/common.json** with navigation and footer translations:
```json
{
  "common": {
    "siteName": "Jerash",
    "allRightsReserved": "All rights reserved.",
    "menu": "Menu",
    "loading": "Loading..."
  },
  "nav": {
    "home": "Home",
    "services": "Services",
    "hse": "HSE",
    "gallery": "Gallery",
    "contact": "Contact",
    "careers": "Careers"
  },
  "footer": {
    "quickLinks": "Quick Links",
    "aboutTitle": "About Us",
    "aboutText": "Jerash For Oil Field Services provides comprehensive oil field solutions with an unwavering commitment to safety and excellence.",
    "officesTitle": "Our Offices",
    "offices": {
      "basrah": {
        "name": "Basrah",
        "address": "Basrah, Iraq",
        "phone": "+964 XXX XXX XXXX",
        "email": "basrah@jerash.com"
      },
      "erbil": {
        "name": "Erbil",
        "address": "Erbil, Kurdistan Region, Iraq",
        "phone": "+964 XXX XXX XXXX",
        "email": "erbil@jerash.com"
      },
      "baghdad": {
        "name": "Baghdad",
        "address": "Baghdad, Iraq",
        "phone": "+964 XXX XXX XXXX",
        "email": "baghdad@jerash.com"
      }
    },
    "poBox": "P.O. Box: XXXXX",
    "followUs": "Follow Us"
  },
  "language": {
    "select": "Language",
    "en": "English",
    "ar": "عربي"
  }
}
```

2. **Expand src/locales/ar/common.json** with Arabic translations:
```json
{
  "common": {
    "siteName": "جرش",
    "allRightsReserved": "جميع الحقوق محفوظة.",
    "menu": "القائمة",
    "loading": "جاري التحميل..."
  },
  "nav": {
    "home": "الرئيسية",
    "services": "الخدمات",
    "hse": "الصحة والسلامة",
    "gallery": "المعرض",
    "contact": "اتصل بنا",
    "careers": "الوظائف"
  },
  "footer": {
    "quickLinks": "روابط سريعة",
    "aboutTitle": "من نحن",
    "aboutText": "جرش لخدمات حقول النفط تقدم حلولاً شاملة لحقول النفط مع التزام راسخ بالسلامة والتميز.",
    "officesTitle": "مكاتبنا",
    "offices": {
      "basrah": {
        "name": "البصرة",
        "address": "البصرة، العراق",
        "phone": "+964 XXX XXX XXXX",
        "email": "basrah@jerash.com"
      },
      "erbil": {
        "name": "أربيل",
        "address": "أربيل، إقليم كردستان، العراق",
        "phone": "+964 XXX XXX XXXX",
        "email": "erbil@jerash.com"
      },
      "baghdad": {
        "name": "بغداد",
        "address": "بغداد، العراق",
        "phone": "+964 XXX XXX XXXX",
        "email": "baghdad@jerash.com"
      }
    },
    "poBox": "صندوق البريد: XXXXX",
    "followUs": "تابعنا"
  },
  "language": {
    "select": "اللغة",
    "en": "English",
    "ar": "عربي"
  }
}
```

3. **Convert LanguageSwitcher.tsx to dropdown** (per CONTEXT.md decision):
- Use existing DropdownMenu component from shadcn
- Display Globe icon + current language name as trigger
- Show "English" and "عربي" as text options (no flags per user decision)
- Position in header right corner with `align="end"` (logical, not "right")
- Highlight currently selected language with accent background
- Use `me-2` (not `mr-2`) for icon spacing (RTL-aware)
  </action>
  <verify>
- `pnpm build` succeeds with no TypeScript errors
- Visiting `/` shows dropdown language switcher in header
- Clicking dropdown shows "English" and "عربي" options
- Selecting a language changes site content and persists on page refresh
  </verify>
  <done>
Language switcher is a dropdown. All nav/footer translation keys exist in both languages. Language preference persists via i18next localStorage detection.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add language change fade transition and loading overlay</name>
  <files>
    - src/hooks/useFirstVisit.ts
    - src/components/common/LoadingOverlay.tsx
    - src/components/layout/RootLayout.tsx
    - src/components/common/index.ts
    - src/hooks/index.ts
  </files>
  <action>
1. **Create src/hooks/useFirstVisit.ts**:
- Hook that checks sessionStorage for 'hasVisited' key
- Returns `{ isFirstVisit: boolean, markVisited: () => void }`
- Handle SSR case: if `typeof window === 'undefined'`, return false for isFirstVisit
- Use useState with lazy initializer to read sessionStorage only once
- markVisited sets sessionStorage and updates state to false

2. **Create src/components/common/LoadingOverlay.tsx**:
- Uses useFirstVisit hook to determine if overlay should show
- Full-screen fixed overlay with z-[100] (above everything)
- Background: `bg-background` (matches site theme)
- Centered Jerash logo: `/Jerash-logo-color.png`
- Logo animation (per CONTEXT.md: fade in with scale effect):
  - initial: `{ scale: 0.8, opacity: 0 }`
  - animate: `{ scale: 1, opacity: 1 }`
  - transition: `{ duration: 0.6, ease: [0.4, 0, 0.2, 1] }`
- After ~1.5s total, overlay fades out:
  - exit: `{ opacity: 0 }`
  - transition: `{ duration: 0.5 }`
- Use useEffect with setTimeout to trigger markVisited and hide overlay
- Wrap in AnimatePresence for exit animation

3. **Update src/components/layout/RootLayout.tsx**:
- Import LoadingOverlay and render at top of return (outside main layout)
- Wrap main content (Header + main + Footer) in AnimatePresence + motion.div
- Key the motion.div on `i18n.language` to trigger fade on language change
- Fade transition: initial/exit `{ opacity: 0 }`, animate `{ opacity: 1 }`, duration 0.2s
- Use `mode="wait"` on AnimatePresence for clean exit-before-enter

4. **Export from index files**:
- Add LoadingOverlay to src/components/common/index.ts
- Add useFirstVisit to src/hooks/index.ts
  </action>
  <verify>
- `pnpm build` succeeds
- On first visit (clear sessionStorage or incognito), logo animation plays for ~1.5s then fades
- On subsequent navigation within session, no loading overlay appears
- Switching language causes brief fade out/in of content
- Layout direction (RTL/LTR) switches correctly with language
  </verify>
  <done>
Loading overlay shows Jerash logo with scale+fade animation on first session visit only. Content fades briefly when toggling language. RTL/LTR direction changes automatically.
  </done>
</task>

</tasks>

<verification>
Phase 01-01 verification:
1. **Translation coverage**: All keys used by nav/footer exist in both en/ar JSON files
2. **Language switching**: Dropdown works, selection persists across refresh
3. **RTL switching**: `document.dir` is "rtl" when Arabic selected, "ltr" for English
4. **Loading overlay**: Shows only on first visit per session (sessionStorage-based)
5. **Fade transition**: Language change triggers smooth content fade
6. **Build health**: `pnpm build` and `pnpm lint` pass
</verification>

<success_criteria>
- [ ] Dropdown language switcher displays current language with Globe icon
- [ ] Selecting language updates all visible text to that language
- [ ] Language preference survives page refresh (localStorage)
- [ ] Layout direction matches language (RTL for Arabic, LTR for English)
- [ ] Logo loading overlay appears on first visit with scale+fade animation
- [ ] Loading overlay does not appear on in-session navigation
- [ ] Content fades briefly (0.2s) when language is toggled
- [ ] All translation keys for nav and footer exist in both language files
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-layout/01-01-SUMMARY.md`
</output>
