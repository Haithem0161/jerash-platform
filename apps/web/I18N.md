# i18n Guide (react-i18next)

## Installation

```bash
pnpm add i18next react-i18next i18next-browser-languagedetector i18next-resources-to-backend
```

## Configuration

```typescript
// src/lib/i18n.ts
import i18n from 'i18next'
import { initReactI18next } from 'react-i18next'
import LanguageDetector from 'i18next-browser-languagedetector'
import resourcesToBackend from 'i18next-resources-to-backend'

export const supportedLanguages = ['en', 'ar'] as const
export type SupportedLanguage = (typeof supportedLanguages)[number]

export const defaultLanguage: SupportedLanguage = 'en'

i18n
  // Lazy load translations
  .use(resourcesToBackend((language: string, namespace: string) =>
    import(`../locales/${language}/${namespace}.json`)
  ))
  // Detect user language
  .use(LanguageDetector)
  // Pass i18n to react-i18next
  .use(initReactI18next)
  .init({
    fallbackLng: defaultLanguage,
    supportedLngs: supportedLanguages,

    // Namespaces
    ns: ['common', 'home', 'auth'],
    defaultNS: 'common',

    // Detection order
    detection: {
      order: ['localStorage', 'navigator', 'htmlTag'],
      caches: ['localStorage'],
      lookupLocalStorage: 'language',
    },

    interpolation: {
      escapeValue: false, // React already escapes
    },

    react: {
      useSuspense: true,
    },
  })

export default i18n
```

## Provider Setup

```tsx
// src/main.tsx
import { StrictMode, Suspense } from 'react'
import { createRoot } from 'react-dom/client'
import './lib/i18n' // Initialize i18n
import App from './App'

createRoot(document.getElementById('root')!).render(
  <StrictMode>
    <Suspense fallback={<div>Loading...</div>}>
      <App />
    </Suspense>
  </StrictMode>
)
```

## Translation Files

```
src/
└── locales/
    ├── en/
    │   ├── common.json
    │   ├── home.json
    │   └── auth.json
    └── ar/
        ├── common.json
        ├── home.json
        └── auth.json
```

```json
// src/locales/en/common.json
{
  "nav": {
    "home": "Home",
    "about": "About",
    "contact": "Contact"
  },
  "actions": {
    "save": "Save",
    "cancel": "Cancel",
    "delete": "Delete"
  },
  "greeting": "Hello, {{name}}!",
  "items_one": "{{count}} item",
  "items_other": "{{count}} items"
}
```

```json
// src/locales/ar/common.json
{
  "nav": {
    "home": "الرئيسية",
    "about": "حول",
    "contact": "اتصل بنا"
  },
  "actions": {
    "save": "حفظ",
    "cancel": "إلغاء",
    "delete": "حذف"
  },
  "greeting": "مرحباً، {{name}}!",
  "items_zero": "لا عناصر",
  "items_one": "عنصر واحد",
  "items_two": "عنصران",
  "items_few": "{{count}} عناصر",
  "items_many": "{{count}} عنصراً",
  "items_other": "{{count}} عنصر"
}
```

## useTranslation Hook

```tsx
import { useTranslation } from 'react-i18next'

function MyComponent() {
  const { t, i18n } = useTranslation()

  return (
    <div>
      {/* Simple key */}
      <h1>{t('nav.home')}</h1>

      {/* With interpolation */}
      <p>{t('greeting', { name: 'Ahmed' })}</p>

      {/* Pluralization */}
      <p>{t('items', { count: 5 })}</p>

      {/* From specific namespace */}
      <p>{t('title', { ns: 'home' })}</p>

      {/* Current language */}
      <p>Current: {i18n.language}</p>
    </div>
  )
}
```

### Multiple Namespaces

```tsx
function AuthPage() {
  // Load multiple namespaces
  const { t } = useTranslation(['auth', 'common'])

  return (
    <div>
      {/* Default namespace (auth) */}
      <h1>{t('login.title')}</h1>

      {/* Explicit namespace */}
      <button>{t('actions.save', { ns: 'common' })}</button>
    </div>
  )
}
```

### Key Prefix

```tsx
function LoginForm() {
  // All keys prefixed with 'login'
  const { t } = useTranslation('auth', { keyPrefix: 'login' })

  return (
    <form>
      <h1>{t('title')}</h1>        {/* auth:login.title */}
      <label>{t('email')}</label>   {/* auth:login.email */}
      <label>{t('password')}</label> {/* auth:login.password */}
    </form>
  )
}
```

## Trans Component

For translations containing JSX elements:

```tsx
import { Trans } from 'react-i18next'

// Translation: "Read our <link>terms of service</link> and <bold>privacy policy</bold>."
function Legal() {
  return (
    <Trans
      i18nKey="legal.terms"
      components={{
        link: <a href="/terms" className="underline" />,
        bold: <strong />,
      }}
    />
  )
}

// With interpolation
// Translation: "Welcome back, <bold>{{name}}</bold>! You have <count>{{count}}</count> notifications."
function Welcome({ name, count }: { name: string; count: number }) {
  return (
    <Trans
      i18nKey="welcome.message"
      values={{ name, count }}
      components={{
        bold: <strong className="font-semibold" />,
        count: <span className="text-blue-500" />,
      }}
    />
  )
}
```

## Pluralization

### English (2 forms)

```json
{
  "message_one": "You have {{count}} message",
  "message_other": "You have {{count}} messages"
}
```

### Arabic (6 forms)

Arabic has complex plural rules based on the number:

| Form | Numbers | Example |
|------|---------|---------|
| `zero` | 0 | لا رسائل |
| `one` | 1 | رسالة واحدة |
| `two` | 2 | رسالتان |
| `few` | 3-10 | {{count}} رسائل |
| `many` | 11-99 | {{count}} رسالة |
| `other` | 100+ | {{count}} رسالة |

```json
{
  "message_zero": "لا رسائل",
  "message_one": "رسالة واحدة",
  "message_two": "رسالتان",
  "message_few": "{{count}} رسائل",
  "message_many": "{{count}} رسالة",
  "message_other": "{{count}} رسالة"
}
```

```tsx
// Usage is the same - i18next handles the form automatically
t('message', { count: 0 })   // -> "لا رسائل"
t('message', { count: 1 })   // -> "رسالة واحدة"
t('message', { count: 2 })   // -> "رسالتان"
t('message', { count: 5 })   // -> "5 رسائل"
t('message', { count: 50 })  // -> "50 رسالة"
```

## Interpolation & Formatting

### Variables

```json
{
  "welcome": "Welcome, {{name}}!",
  "order": "Order #{{orderId}} - {{status}}"
}
```

```tsx
t('welcome', { name: 'Ahmed' })
t('order', { orderId: '12345', status: 'Shipped' })
```

### Numbers

```json
{
  "price": "Price: {{val, number}}",
  "percent": "Discount: {{val, number(style: percent)}}"
}
```

```tsx
t('price', { val: 1234.56 })  // -> "Price: 1,234.56"
t('percent', { val: 0.25 })   // -> "Discount: 25%"
```

### Currency

```json
{
  "total": "Total: {{val, currency(USD)}}"
}
```

```tsx
t('total', { val: 99.99 })  // -> "Total: $99.99"
```

### Dates

```json
{
  "createdAt": "Created: {{val, datetime}}",
  "deadline": "Due: {{val, datetime(dateStyle: long)}}"
}
```

```tsx
t('createdAt', { val: new Date() })
t('deadline', {
  val: new Date(),
  formatParams: {
    val: { dateStyle: 'full', timeStyle: 'short' }
  }
})
```

## Language Switching

```tsx
import { useTranslation } from 'react-i18next'
import { supportedLanguages, type SupportedLanguage } from '@/lib/i18n'

const languageNames: Record<SupportedLanguage, string> = {
  en: 'English',
  ar: 'العربية',
}

function LanguageSwitcher() {
  const { i18n } = useTranslation()

  const changeLanguage = (lng: SupportedLanguage) => {
    i18n.changeLanguage(lng)
  }

  return (
    <div className="flex gap-2">
      {supportedLanguages.map((lng) => (
        <button
          key={lng}
          onClick={() => changeLanguage(lng)}
          disabled={i18n.language === lng}
          className={cn(
            'px-3 py-1 rounded',
            i18n.language === lng
              ? 'bg-blue-500 text-white'
              : 'bg-gray-200 hover:bg-gray-300'
          )}
        >
          {languageNames[lng]}
        </button>
      ))}
    </div>
  )
}
```

## RTL Support

### Detecting Direction

```tsx
import { useTranslation } from 'react-i18next'

function useDirection() {
  const { i18n } = useTranslation()
  return i18n.dir() // 'ltr' or 'rtl'
}

// Or check specific language
i18n.dir('ar')  // -> 'rtl'
i18n.dir('en')  // -> 'ltr'
```

### Apply to Document

```tsx
// src/App.tsx
import { useEffect } from 'react'
import { useTranslation } from 'react-i18next'

function App() {
  const { i18n } = useTranslation()

  useEffect(() => {
    const dir = i18n.dir()
    const lang = i18n.language

    document.documentElement.dir = dir
    document.documentElement.lang = lang
  }, [i18n.language])

  return <RouterProvider router={router} />
}
```

### RTL with Tailwind CSS

Tailwind v3.3+ has built-in RTL support with `rtl:` and `ltr:` variants:

```html
<!-- Automatic margin direction -->
<div class="ms-4">Margin start (left in LTR, right in RTL)</div>
<div class="me-4">Margin end (right in LTR, left in RTL)</div>
<div class="ps-4">Padding start</div>
<div class="pe-4">Padding end</div>

<!-- Text alignment -->
<p class="text-start">Aligned to start</p>
<p class="text-end">Aligned to end</p>

<!-- Flexbox -->
<div class="flex-row">Auto-reverses in RTL</div>

<!-- Explicit RTL/LTR variants -->
<div class="ltr:pl-4 rtl:pr-4">Explicit padding</div>
<div class="ltr:rounded-l-lg rtl:rounded-r-lg">Explicit radius</div>

<!-- Icons that need flipping -->
<svg class="rtl:rotate-180">Arrow icon</svg>
```

### RTL-aware Component Example

```tsx
function Card({ title, description }: CardProps) {
  return (
    <div className="flex items-start gap-4">
      <div className="shrink-0">
        <Avatar />
      </div>
      <div className="flex-1 min-w-0">
        <h3 className="text-start font-semibold">{title}</h3>
        <p className="text-start text-gray-600">{description}</p>
      </div>
      <ChevronIcon className="rtl:rotate-180" />
    </div>
  )
}
```

## Lazy Loading

Translations are lazy-loaded by default with our setup:

```typescript
// Only loaded when needed
.use(resourcesToBackend((language: string, namespace: string) =>
  import(`../locales/${language}/${namespace}.json`)
))
```

### Load Additional Namespaces

```tsx
import { useTranslation } from 'react-i18next'
import { useEffect } from 'react'

function AdminPage() {
  const { t, i18n } = useTranslation()

  // Load admin namespace on mount
  useEffect(() => {
    i18n.loadNamespaces('admin')
  }, [i18n])

  return <div>{t('admin:dashboard.title')}</div>
}
```

### Suspense Fallback

```tsx
function App() {
  return (
    <Suspense fallback={<LoadingSpinner />}>
      <Routes />
    </Suspense>
  )
}
```

## TypeScript

### Type-Safe Translations

```typescript
// src/types/i18next.d.ts
import 'i18next'
import type common from '../locales/en/common.json'
import type home from '../locales/en/home.json'
import type auth from '../locales/en/auth.json'

declare module 'i18next' {
  interface CustomTypeOptions {
    defaultNS: 'common'
    resources: {
      common: typeof common
      home: typeof home
      auth: typeof auth
    }
  }
}
```

Now TypeScript will autocomplete and validate translation keys:

```tsx
const { t } = useTranslation()

t('nav.home')        // ✓ Valid
t('nav.nonexistent') // ✗ Type error
t('greeting', { name: 'Ahmed' }) // ✓ Valid with interpolation
```

## File Organization

```
src/
├── lib/
│   └── i18n.ts              # i18n configuration
├── locales/
│   ├── en/
│   │   ├── common.json      # Shared translations (nav, buttons, errors)
│   │   ├── home.json        # Home page
│   │   ├── auth.json        # Login/signup
│   │   └── dashboard.json   # Dashboard feature
│   └── ar/
│       ├── common.json
│       ├── home.json
│       ├── auth.json
│       └── dashboard.json
├── components/
│   └── LanguageSwitcher.tsx
├── hooks/
│   └── useDirection.ts      # RTL helper hook
└── types/
    └── i18next.d.ts         # TypeScript declarations
```

## Key Rules

1. **Use namespaces** - Split by feature/page, not by component
2. **Keep keys flat when possible** - `nav.home` over deeply nested
3. **Use semantic key names** - `actions.save` not `button1`
4. **Handle all Arabic plural forms** - 6 forms for proper grammar
5. **Use logical properties** - `ms-4` not `ml-4` for RTL support
6. **Lazy load** - Only load namespaces when needed
7. **Add TypeScript types** - Autocomplete and validation
8. **Test RTL** - Verify layout with Arabic language
9. **Avoid hardcoded text** - Even "OK" buttons should be translated
10. **Use Trans for JSX** - Not string concatenation
